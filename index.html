<!--
Copyright 2022, CFL Enterprises LP

Draft Selection Order tool.

If you find this useful you can use it.  All CFL logos, word marks,
or other branded material muxt be removed.

-->
<html>
	<head>
	    <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1">

	    <!-- Bootstrap CSS -->
	    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

		<title>CFL Draft Selection</title>
		<style type="text/css">
			.header-wrapper {
				background-color: #2A292A;
			}

			.header_holder img {
				height: 120px;
				padding-top: 10px;
				padding-bottom: 10px;
			}

			.main-title {
				padding: 10px 20px 10px 20px;
			}

			.draft-order-grey {
				background-color: #2A292A;
			}

			body {
				background-color: #252324;
				color: #FFF;
			}
		</style>
	</head>
	<body>
		<div class="container-fluid">
			<div class="header-wrapper row align-items-center">
				<div class="col-sm-4">
					<div class="header_holder">
						<img src="cfl_draft.jpg" alt="CFL Draft" />
					</div>
				</div>
				<div class="col-sm-6 offset-sm-2 text-start text-md-end">
					<h1 class="main-title">CFL Draft Selection</h1>
				</div>
			</div>
		</div>
		<div class="container">
			<div class="col-8">
			<div class="row align-items-center fw-bold pt-5">
				<div class="col-4 col-sm-3 p-2 draft-order-grey">
					Team
				</div>
				<div class="col-5 col-sm-6 p-2 draft-order-grey">
					Count
				</div>
			</div>
			<div class="row justify-content-center">
				<form id="draftInput">
					<div class="team row pt-3 mb-3 align-items-center justify-content-start">
						<div class="name col-4 col-sm-3 col-form-label">BC</div>
						<div class="col-3">
							<div class="count"><input type="number" name="bc_count" class="numberInput form-control" min="1" max="9" step="1" /></div>
						</div>
						<div class="col-3">
							<div class="balls"></div>
						</div>
					</div>
					<div class="team row mb-3 align-items-center justify-content-start">
						<div class="name col-4 col-sm-3 col-form-label">Calgary</div>
						<div class="col-3">
							<div class="count"><input type="number" name="cgy_count" class="numberInput form-control" min="1" max="9" step="1" /></div>
						</div>
						<div class="col-3">
							<div class="balls"></div>
						</div>
					</div>
					<div class="team row mb-3 align-items-center justify-content-start">
						<div class="name col-4 col-sm-3 col-form-label">Edmonton</div>
						<div class="col-3">
							<div class="count"><input type="number" name="edm_count" class="numberInput form-control" min="1" max="9" step="1" /></div>
						</div>
						<div class="col-3">
							<div class="balls"></div>
						</div>
					</div>
					<div class="team row mb-3 align-items-center justify-content-start">
						<div class="name col-4 col-sm-3 col-form-label">Ottawa</div>
						<div class="col-3">
							<div class="count"><input type="number" name="ott_count" class="numberInput form-control" min="1" max="9" step="1" /></div>
						</div>
						<div class="col-3">
							<div class="balls"></div>
						</div>
					</div>
					<div class="team row mb-3 align-items-center justify-content-start">
						<div class="name col-4 col-sm-3 col-form-label">Toronto</div>
						<div class="col-3">
							<div class="count"><input type="number" name="tor_count" class="numberInput form-control" min="1" max="9" step="1" /></div>
						</div>
						<div class="col-3">
							<div class="balls"></div>
						</div>
					</div>
					<div class="team row mb-3 align-items-center justify-content-start">
						<div class="name col-4 col-sm-3 col-form-label">Hamilton</div>
						<div class="col-3">
							<div class="count"><input type="number" name="ham_count" class="numberInput form-control" min="1" max="9" step="1" /></div>
						</div>
						<div class="col-3">
							<div class="balls"></div>
						</div>
					</div>
					<div class="team row mb-3 align-items-center justify-content-start">
						<div class="name col-4 col-sm-3 col-form-label">Montreal</div>
						<div class="col-3">
							<div class="count"><input type="number" name="mtl_count" class="numberInput form-control" min="1" max="9" step="1" /></div>
						</div>
						<div class="col-3">
							<div class="balls"></div>
						</div>
					</div>
					<div class="team row mb-3 align-items-center justify-content-start">
						<div class="name col-4 col-sm-3 col-form-label">Saskatchewan</div>
						<div class="col-3">
							<div class="count"><input type="number" name="ssk_count" class="numberInput form-control" min="1" max="9" step="1" /></div>
						</div>
						<div class="col-3">
							<div class="balls"></div>
						</div>
					</div>
					<div class="team row mb-3 align-items-center justify-content-start">
						<div class="name col-4 col-sm-3 col-form-label">Winnipeg</div>
						<div class="col-3">
							<div class="count"><input type="number" name="wpg_count" class="numberInput form-control" min="1" max="9" step="1" /></div>
						</div>
						<div class="col-3">
							<div class="balls"></div>
						</div>
					</div>
				</form>

				<form id="pickInput">
					<div class="pickinput-container">
						<div class="row pt-3 pb-3">
							<div class="total col-9 draft-order-grey fw-bold fs-5 pt-2 pb-2">
								Total count: <span class="totalBalls"></span>
							</div>
						</div>
						<div class="row pt-3">
							<div class="doit">
								<input class="pickIt btn btn-light" type="button" value="Pick next team" />
							</div>
						</div>
					</div>
				</form>

				<div class="output">
					<ol id="teamList">
					</ol>
				</div>
			</div><!--.row-->
			</div>
		</div><!-- .container -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
		<script>
			$(document).ready( function($) {
				var $teams = $('#draftInput .team'),
					$teamList = $('#teamList'),
					$teamBalls = $teams.find('.balls'),
					$pickForm = $('#pickInput'),
					$totalBalls = $pickForm.find('.totalBalls'),
					$pickButton = $pickForm.find('input.pickIt');

				// D = "global" object for -D-raft order picker
				var D = {
					fromOneToN: function(n) {
						return Math.floor( Math.random() * n ) + 1;
					},

					inputListener: function (el) {
						$teamList.empty();
						$teamBalls.empty();
						$totalBalls.empty();

						var $myBalls = $(this).parent().siblings('.balls');
						console.log('inputListener', $(this), $myBalls);

						$teams.each(function(index) {
							var $team = $(this),
								$ballDisplay = $team.find('.balls');

								$ballDisplay.removeData('used');
								$ballDisplay.css('color', '')
								$ballDisplay.removeData('bottom');
								$ballDisplay.removeData('top');
								$ballDisplay.empty();

								D.setCounts();
						});
					},

					setCounts: function() {
						var count = 1;
						$teams.each(function(index) {
							var $team = $(this),
								ballCount = parseInt($team.find('.numberInput').val(), 10),
								$ballDisplay = $team.find('.balls'),
								bottom = count,
								top;
								if($ballDisplay.data('used')) {
									return;
								}

								if(ballCount) {
									top = count + ballCount - 1,
									count = top + 1;
									$ballDisplay.text(bottom + ' - ' + top);
									$ballDisplay.data('bottom', bottom);
									$ballDisplay.data('top', top);
								} else {
									$ballDisplay.removeData('bottom');
									$ballDisplay.removeData('top');
								}

								$totalBalls.text(count - 1);
						})
					},

					pickListener: function(el) {
						console.log('picker');
						var topBall = 0;
						$teamBalls.each(function() {
							var $ball = $(this),
								t = $ball.data('top'),
								used = $ball.data('used');
							if( ! used) {
								topBall = t && (t > topBall) ? t : topBall;
							}
						});

						console.log('top', topBall);
						if(topBall) {
							var roll, rollName;

							roll = D.fromOneToN(topBall);

							console.log('roll', roll);

							$teamBalls.each(function(){
								var $ball = $(this),
									bottom = $ball.data('bottom'),
									top = $ball.data('top');
								if(top && (bottom <= roll) && (roll <= top)) {
									$ball.data('used', 1);
									$ball.css('color', 'red').text('selected');
									console.log('par', $ball.parent()[0]);
									rollName = $ball.parent().siblings('.name').text();
								}
							});
							var item = "<li>" + rollName + " (roll was: " + roll + " of " + topBall + ")</li>";
							console.log('item', $teamList[0]);
							D.setCounts();
							$teamList.append(item);
						}
					}
				}

				$teams.on('change', 'input', {}, D.inputListener);
				$pickForm.on('submit', false);
				$pickButton.on('click', D.pickListener);
			});
		</script>
	</body>
</html>